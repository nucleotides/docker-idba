#!/bin/bash

#!/bin/bash

set -o errexit
set -o nounset

# Destination output directory
DIR=$3

# Set up logging
LOG=$DIR/log.txt
exec  > ${LOG}
exec 2> ${LOG}
set -o xtrace

# Destination contigs file
ASSEMBLY=$DIR/contigs.fa

# Source reads in this container
READS=$2

# Determine which process to run
PROC=$1
CMD=$(grep ${PROC} /Procfile | cut -f 2 -d ':')

if [[ -z ${CMD} ]]; then
	echo "Abort, no proc found for ${PROC}."
	exit 1
fi

# Convert reads to fastq
TMP=`mktemp -d`
gunzip $READS --stdout > $TMP/reads.fq
fq2fa --paired ${TMP}/reads.fq ${TMP}/reads.fa

${CMD}

OUTPUT=$(ls -t $TMP/graph-*.fa | head -n 1)
cp $OUTPUT $ASSEMBLY
